From 4063a7c63935e29528514386350182bc8446fedc Mon Sep 17 00:00:00 2001
Message-Id: <4063a7c63935e29528514386350182bc8446fedc.1522099420.git.Jim.Somerville@windriver.com>
In-Reply-To: <37dfb62264baec527d56aaf20db887840bec1ea1.1522099415.git.Jim.Somerville@windriver.com>
References: <37dfb62264baec527d56aaf20db887840bec1ea1.1522099415.git.Jim.Somerville@windriver.com>
From: Kam Nasim <kam.nasim@windriver.com>
Date: Wed, 10 Jan 2018 17:34:42 -0500
Subject: [PATCH 29/32] export module signing key in kernel devel

Signed-off-by: Jim Somerville <Jim.Somerville@windriver.com>
---
 SPECS/kernel.spec | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/SPECS/kernel.spec b/SPECS/kernel.spec
index 7735ebf..03863a6 100644
--- a/SPECS/kernel.spec
+++ b/SPECS/kernel.spec
@@ -1155,6 +1155,12 @@ BuildKernel() {
     cp signing_key.priv signing_key.priv.sign${Flavour:+.${Flavour}}
     cp signing_key.x509 signing_key.x509.sign${Flavour:+.${Flavour}}
 
+    # WRS: Copy these keys as part of the devel package
+    # The Module signing keys are to ensure that only Out-of-tree
+    # built against the Titanium Kernel get signed and loaded sans warnings
+    cp signing_key.priv ${RPM_BUILD_ROOT}/lib/modules/${KernelVer}/build/
+    cp signing_key.x509 ${RPM_BUILD_ROOT}/lib/modules/${KernelVer}/build/
+
     # remove files that will be auto generated by depmod at rpm -i time
     for i in alias alias.bin builtin.bin ccwmap dep dep.bin ieee1394map inputmap isapnpmap ofmap pcimap seriomap symbols symbols.bin usbmap softdep devname
     do
-- 
1.8.3.1

